---
title: 使用redis的10个技巧
date: 2019-12-19 20:24:51
thumbnail: /gallery/thumbnail/redis.jpg
categories:
    - 中间件
tags:
    - redis
---


### 使用redis的小建议

该篇转载自公众号《java专栏》，当然也是个人做了一些调整的，但是我在csdn上同样发现了相同的文章，本来这篇就不想写了，也不知道究竟谁是原创...最后加几条自己的经验
CSDN：https://blog.csdn.net/dannyiscoder/article/details/78281896
https://www.cnblogs.com/itxuexiwang/p/5199000.html

1. 停止使用keys *

这个理由就不多说了，简但说明就是redis单线程处理，而它比较耗时，会拖慢redis。当然，是对于线上环境来说的。如果有遍历key的需求可以使用redis的游标`scan`取而代之；

2. 查看redis命令统计

redis没有详细的日志，但是提供了一个命令统计工具，通过它可以查看`执行的命令：执行次数，执行次数总耗时，执行平均耗时`;
``` bash
# 在redis-cli中使用
info commandstats

```
对于统计结果，可以使用`config resetstat`来重置它；

3. 仅仅将redis-benchmark统计的结果作为参考

redis-benchmark给测试的结果提供了一个保证redis-server不会运行在一个异常状态下的基准点，但是不能够拿来当作真实的压力测试；最真实的当然是直接压生产环境，因为不同的环境的各种因素是不一样的；

4. 使用hash来简化数据

在redis中可能有很多的key，有的key的种类可能是一样的，比如说会见到这样的key ：food:rise 这样描述同一种类的key，就比较推荐使用hash结构来简化，而且还方便按类别取出，避免使用keys food* 这样的语句，而使用`hgetall`来代替。但是要注意一点，hash中的键是不能设置过期时间的，只能对hash设置，所以有过期需求的还是需要用value的模式；

5. 对key设置过期时间

无论是从节省空间，还是业务需要来说，这都是比较需要的，除非有一些长期静态的数据；

6. 使用合适的回收策略

对于这一点在以往的redis文章中已经描述了redis的几种key回收策略，那么我们就需要结合业务自身，选择合理的策略；

7. 如果数据比较重要，请使用try/except

在程序中对于这样的需要io操作的redis命令，使用try是应该的一般来说重要的数据都是落库的（可能是mysql），所以try可以在即使redis保存失败的时候能正确落库。
ps 这里是我的推断，原文并不是这样。

8. 不要耗尽一个实例

意思就是如果确实有必要存在在redis中的数据，单个实例已经保存不了这么多数据，可以使用集群分撒数据；

9. 内核越多越好？

这里之前也说过了，redis是单线程，最好的方式就是将redis启动的时候绑定cup核心，再加上redis的同步策略，2核足够了。

10. 确保redis高可用

当然这时需要考虑的事情，毕竟只有一台redis可用性就会难以保证。
sen'tinel-哨兵 或者是集群主从都是可以的，具体要看业务的量有多大；

以下是一些自己的经验：

11. 不同的项目使用不同redis db

redis默认有16个db，0-15。所以在开发测试环境的时候，可以对不同的项目分配不同的db段使用，避免资源浪费。

12. 不要随意使用flush

flush db（清除一个db的内容）  和 flush all（清除所有内容） 在测试的时候经常会用到，可能要测试的时候需要经常清除数据。如果项目组不是只有一个人的话，或者你是用的不是自己本地redis。那么我建议在flush 的时候照顾以下别人的感受。原因大家应该懂的...

13. 使用批量操作

在大量插入的时候或者是大量查询的时候，可以使用pipleline批量操作代替循环插入，节省总时间。不适用于在请求比较少的时候。